<%= render "shared/header" %>
<% if user_signed_in? %>
  <%= render 'layouts/sidebar' %>
<% end %>
<% if @chat.errors.any? %>
  <div class="error_explanation">
    <h2><%= pluralize(@chat.errors.count, "error") %> prohibited this chat from being saved:</h2>
    <ul>
      <% @chat.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<div class="chats-container">
  <% @chats.each do |chat| %>
    <div class="chat <%= chat.user == current_user ? 'current-user' : 'other-user' %>">
      
      <!-- 1. ユーザー名をspanタグで強調し、左寄せ -->
      <div class="user-info">
        <p><span class="user-name"><%= chat.user.name %></span>さんが投稿しました</p>
      </div>

      <!-- 2. メッセージと削除ボタンは横並び -->
      <div class="chat-message">
        <div class="message-content">
          <%= raw chat.message_content %>
        </div>
        <% if chat.user == current_user %>
          <div class="delete-button">
            <%= link_to chat_path(chat), data: { turbo_method: :delete } do %>
              <%= image_tag('destroy-icon.png', alt: '削除', class: 'index-destroy-icon') %>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- 3. 投稿日時は右寄せ -->
      <div class="chat-date">
        <%= chat.created_at.strftime("%Y-%m-%d %H:%M") %>
      </div>

    </div>
  <% end %>
</div>
<% if user_signed_in? %>
  <div class="chat-input-container">
    <%= form_with(model: @chat, url: chats_path, local: true, html: { class: 'chat-form' }) do |form| %>
      <div class="input-area">
        <%= form.text_area :message_content, placeholder: "メッセージを入力...", rows: 3, class: 'message-input' %>
        <%= form.submit "送 信", class: 'chat-button' %>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="chat-input-container2">
    <p>※チャットを投稿するにはログインが必要です※</p>
  </div>
<% end %>